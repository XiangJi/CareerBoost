# Reservoir Sampling

Reservoir sampling 是一个随机采样算法，简单来说就是从 n 个 items 中随机选择 k 个items，并且每个 item 被选择的概率应该都一样。

这个算法的优点在于时空复杂度都不高，其中时间复杂度为 O(n), 空间复杂度为 O(1)。

数学证明：

假设现在要从 n 个数里面随机选择一个数，那么通过 Reservoir sampling 选择的流程如下

记最终选择的数为 result
遍历数组，对于数组第 i 个数，以 1/i 的概率将其赋给result（i从1开始，所以第一个数肯定会赋给result）
遍历完数组后得到的 result 即为产生的随机数
假设现在有数组 [1, 2, 3], 随机产生一个数，那么按照上面的流程有

遍历第一个数时，result = 1
遍历第二个数时，result = 2 的概率为 1/2, 即 result = 1 的概率也是 1/2
遍历第三个数时，result = 3 的概率为 1/3, result = 1 的概率为 (1 - 1/3) * 1/2 = 1/3, 同理 result = 2 的概率也是 1/3
上面的 (1 - 1/3) * 1/2 指的是这一次没有选择第三个数且之前 result 的值为1的概率，通过数学归纳法可以很容易的证明遍历完整个数组后每个数被选择的概率是 1/n (n 为数组的长度)

而假如要从 n 个数里面随机选择 k 个数时，Reservoir sampling 的过程类似上面的

选择前 k 个数作为 result
从第 k+1 个数开始遍历数组，对于数组第 k+i（i=1,2,…..）个数，以 kk+i 的概率选择这个数加入result并替换掉 result 中的任意一个数
遍历完数组后得到的 result 即为产生的 k 个随机样本
下面通过数学归纳法证明通过上面的算法过程最终每个数被选择的概率为 k/n
1) i=1 时，选择第 k+1 个数的概率为 kk+1，而在 result 中 k 个数里面的一个(记为 x) 能够保留下来的概率为是 x 原来在 result中且这一次没有被替换的概率，而这一次没有被替换掉又可分为两种情况，一种是根本没有选择到第 k+i 个数，一种是选择了第 k+i 个数，但是替换 k 个数中的一个时没有替换掉 x。公式表示为

p(x上一次在result中)∗p(x没有被替换掉)=1∗（kk+1∗(1−1k)+(1−kk+1)）=kk+1
即每个数被选择的概率为 kk+1
2) 因此当 i=m 时，每个数被选择的概率为 k/(k+m)
3) 则当 i=m+1 时，选择第 k+m+1 个数的概率为 kk+m+1, 在 result 中 k 个数里面的一个(记为 x) 能够保留下来的概率为:

p(x上一次在result中)∗p(x没有被替换掉)=kk+m∗（kk+m+1∗(1−1k)+(1−kk+m+1)）=kk+m+1
从上可知，遍历到第 i 个数的时候，前 k+i 每个数被选择的概率为 k/(k+i),则遍历完 n 个数后，每个数被选择的概率为 k/n



## Random in java

一、Math.random()

随即生成0<x<1的小数。

实例：如何写，生成随机生成出0~100中的其中一个数呢？

​    Math.random()返回的只是从0到1之间的小数，如果要50到100，就先放大50倍，即0到50之间，这里还是小数，如果要整数，就强制转换int，然后再加上50即为50~100.
最终代码：(int)(Math.random()*50) + 50

 

二、Random类

Random random = new Random();//默认构造方法

Random random = new Random(1000);//指定种子数字

在进行随机时，随机算法的起源数字称为种子数(seed)，在种子数的基础上进行一定的变换，从而产生需要的随机数字。

相同种子数的Random对象，相同次数生成的随机数字是完全相同的。也就是说，两个种子数相同的Random对象，第一次生成的随机数字完全相同，第二次生成的随机数字也完全相同。

 

2 、Random类中的常用方法

Random 类中的方法比较简单，每个方法的功能也很容易理解。需要说明的是，Random类中各方法生成的随机数字都是均匀分布的，也就是说区间内部的数字生成的几率是均等的。下面对这些方法做一下基本的介绍：

a 、public boolean nextBoolean()

该方法的作用是生成一个随机的boolean值，生成true和false的值几率相等，也就是都是50%的几率。

b 、public double nextDouble()

该方法的作用是生成一个随机的double值，数值介于[0,1.0)之间，这里中括号代表包含区间端点，小括号代表不包含区间端点，也就是0到1之间的随机小数，包含0而不包含1.0。

 

c 、public int nextInt()

该方法的作用是生成一个随机的int值，该值介于int的区间，也就是-2的31次方到2的31次方-1之间。

如果需要生成指定区间的int值，则需要进行一定的数学变换，具体可以参看下面的使用示例中的代码。

d 、public int nextInt(int n)

该方法的作用是生成一个随机的int值，该值介于[0,n)的区间，也就是0到n之间的随机int值，包含0而不包含n。

如果想生成指定区间的int值，也需要进行一定的数学变换，具体可以参看下面的使用示例中的代码。

e 、public void setSeed(long seed)

该方法的作用是重新设置Random对象中的种子数。设置完种子数以后的Random对象和相同种子数使用new关键字创建出的Random对象相同。